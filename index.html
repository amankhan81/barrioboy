<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barrio Boy: The Neon Journey</title>
    <style>
        :root {
            --neon-cyan: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-purple: #bc13fe;
            --neon-green: #39ff14;
            --bg-dark: #0a0a0c;
            --card-bg: rgba(20, 20, 25, 0.95);
            --glass: rgba(255, 255, 255, 0.03);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: #e0e0e0;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Prevent body scroll */
            background-image: 
                radial-gradient(circle at 10% 10%, rgba(188, 19, 254, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 90%, rgba(0, 243, 255, 0.1) 0%, transparent 40%);
        }

        #app-wrapper {
            width: 95vw;
            max-width: 1000px;
            height: 90vh; /* Fixed relative height to fit window */
            max-height: 800px;
            background: var(--card-bg);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 243, 255, 0.1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .screen {
            display: none;
            padding: clamp(20px, 5vh, 40px);
            flex-direction: column;
            flex: 1;
            overflow-y: auto; /* Internal scrolling if content is long */
            animation: slideUp 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .active { display: flex; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Overlay */
        #loader {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-dark);
            z-index: 100;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid transparent;
            border-top-color: var(--neon-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Typography */
        h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            text-align: center;
            background: linear-gradient(to right, var(--neon-cyan), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Login Screen */
        .title-image-container {
            width: 100%;
            flex: 1;
            min-height: 150px;
            max-height: 300px;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            background: #111;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .title-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
            padding-bottom: 10px;
        }

        input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 243, 255, 0.2);
            padding: 12px 20px;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            outline: none;
            transition: 0.3s;
        }

        input:focus {
            border-color: var(--neon-cyan);
            background: rgba(0, 243, 255, 0.05);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }

        /* Quiz UI */
        .progress-container {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            flex-shrink: 0;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, var(--neon-cyan), var(--neon-purple));
            transition: width 0.4s ease;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.8rem;
            color: var(--neon-cyan);
            text-transform: uppercase;
            letter-spacing: 1px;
            flex-shrink: 0;
        }

        .question-box {
            font-size: clamp(1.1rem, 3vh, 1.4rem);
            line-height: 1.4;
            margin-bottom: 25px;
            flex-shrink: 0;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex: 1;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: clamp(12px, 2vh, 18px);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option-card:hover {
            background: rgba(0, 243, 255, 0.05);
            border-color: var(--neon-cyan);
            transform: translateX(4px);
        }

        .option-card.selected {
            background: rgba(188, 19, 254, 0.1);
            border-color: var(--neon-purple);
            box-shadow: 0 0 15px rgba(188, 19, 254, 0.2);
        }

        .option-label {
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.9rem;
            font-weight: bold;
            flex-shrink: 0;
        }

        .option-text {
            font-size: clamp(0.9rem, 2vh, 1.1rem);
        }

        .selected .option-label {
            background: var(--neon-purple);
            color: white;
        }

        /* Controls */
        .btn-row {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            flex-shrink: 0;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: var(--neon-cyan);
            color: #000;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(0, 243, 255, 0.6);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Results */
        .result-grid {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .score-display {
            font-size: clamp(4rem, 15vh, 6rem);
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 0 0 30px var(--neon-green);
            margin: 10px 0;
        }

        .rank-tag {
            background: var(--neon-pink);
            color: white;
            padding: 6px 20px;
            border-radius: 50px;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 0 0 15px var(--neon-pink);
            font-size: 0.9rem;
        }

        #error-msg {
            color: #ff4444;
            font-size: 0.8rem;
            text-align: center;
            margin-top: 5px;
            height: 18px;
        }

        /* Scrollbar Styling */
        .screen::-webkit-scrollbar {
            width: 6px;
        }
        .screen::-webkit-scrollbar-track {
            background: transparent;
        }
        .screen::-webkit-scrollbar-thumb {
            background: rgba(0, 243, 255, 0.2);
            border-radius: 10px;
        }
    </style>
</head>
<body>

<div id="app-wrapper">
    <div id="loader">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: var(--neon-cyan); letter-spacing: 2px; font-size: 0.8rem;">RECONSTRUCTING ENVIRONMENT...</p>
    </div>

    <!-- SCREEN 1: WELCOME -->
    <div id="screen-login" class="screen active">
        <h1>Barrio Boy</h1>
        <p style="text-align: center; color: #888; margin-bottom: 1.5rem; font-size: 0.9rem;">The Neon Journey of Ernesto Galarza</p>
        
        <div class="title-image-container" id="title-image-box">
            <span style="color: #444; font-size: 0.8rem;">[ VISUALIZING NARRATIVE... ]</span>
        </div>

        <div class="input-group">
            <input type="text" id="user-name" placeholder="Name of Applicant..." autocomplete="off">
            <button class="btn btn-primary" onclick="startApp()">Initiate Enrollment</button>
            <div id="error-msg"></div>
        </div>
    </div>

    <!-- SCREEN 2: QUIZ -->
    <div id="screen-quiz" class="screen">
        <div class="progress-container">
            <div id="progress-bar"></div>
        </div>

        <div class="question-header">
            <span id="q-count">Assessment 01</span>
            <span id="score-count">Score: 0</span>
        </div>

        <div class="question-box" id="question-text">
            Loading Inquiry...
        </div>

        <div class="options-grid" id="options-container">
            <!-- Options added via JS -->
        </div>

        <div class="btn-row">
            <button class="btn btn-secondary" id="prev-btn" onclick="nav(-1)">Previous</button>
            <button class="btn btn-primary" id="next-btn" onclick="nav(1)">Next</button>
        </div>
    </div>

    <!-- SCREEN 3: RESULTS -->
    <div id="screen-results" class="screen">
        <div class="result-grid">
            <div class="rank-tag" id="res-rank">Honor Graduate</div>
            <h2 id="res-name" style="font-size: 1.5rem; margin-bottom: 5px;">Player</h2>
            <div class="score-display"><span id="res-score">0</span>/10</div>
            <p id="res-feedback" style="max-width: 500px; line-height: 1.5; color: #aaa; font-size: 0.95rem;"></p>
            <button class="btn btn-primary" style="margin-top: 30px;" onclick="location.reload()">Re-Sync Matrix</button>
        </div>
    </div>
</div>

<script>
    const apiKey = "";
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'barrio-boy-quiz';

    const questions = [
        {
            q: "The sentence 'Almost tiptoeing across the office, I maneuvered myself to keep my mother between me and the gringo lady' primarily serves to:",
            a: ["Demonstrate Ernesto's agility", "Highlight Ernesto's youthful nervousness and caution", "Show that Miss Hopley was physically imposing", "Suggest a lack of trust in his mother"],
            correct: 1
        },
        {
            q: "When Miss Hopley stands up, Ernesto uses the word 'soared' to describe her. This implies:",
            a: ["She was literally flying", "She had a majestic and authoritative presence", "She was angry at the interruption", "She was much taller than Ernesto expected"],
            correct: 1
        },
        {
            q: "The description of Miss Ryan 'crouching' by Ernesto's desk reveals that she is:",
            a: ["Intimidating and aggressive", "Patient and willing to meet students at their level", "Suffering from back pain", "Looking for stolen items"],
            correct: 1
        },
        {
            q: "What was the main philosophy of Lincoln School regarding foreign students?",
            a: ["They should forget their native culture to become 'true' Americans", "They should be separated from native-born Americans", "They could become Americans without losing their original identity", "They were required to only speak English even on playgrounds"],
            correct: 2
        },
        {
            q: "Based on the first paragraph, how does Ernesto initially feel about the Lincoln School?",
            a: ["Excited and adventurous", "Indifferent", "Apprehensive and unsettled by the differences", "Proud of the new yellow paint"],
            correct: 2
        },
        {
            q: "Which detail about the building's roof reinforces Ernesto's sense of displacement?",
            a: ["The shingles were painted yellow", "The roof was missing in some areas", "It was shingled, unlike the red tile roofs in Mazatl√°n", "It was shaped like a double-T"],
            correct: 2
        },
        {
            q: "Why did Ernesto try to teach Miss Ryan Spanish words during their private lessons?",
            a: ["He wanted to show her that Spanish was superior", "He was trying to bridge his two worlds and share his identity", "He was bored with the English lessons", "Miss Ryan asked him to be her teacher"],
            correct: 1
        },
        {
            q: "Which metaphor does the narrator use to describe the school's role in handling racial differences?",
            a: ["A melting pot", "A bridge over a river", "A griddle warming knowledge and roasting hatred", "A classroom of many colors"],
            correct: 2
        },
        {
            q: "In the story, 'butterfly' is a symbol of:",
            a: ["A scary insect", "Ernesto's academic struggle and eventual triumph", "A gift from Miss Ryan", "The school's mascot"],
            correct: 1
        },
        {
            q: "What is the chronological first event mentioned in the excerpt?",
            a: ["Ernesto graduates from first grade", "Ernesto meets Miss Ryan", "Ernesto and his mother walk to the corner of Q Street", "Ernesto learns to say 'pasture'"],
            correct: 2
        }
    ];

    let currentStep = 0;
    let userAnswers = new Array(questions.length).fill(null);
    let userName = "";

    async function generateTitleImage() {
        const prompt = "A nostalgic, cinematic wide-angle shot set in a 1920s California classroom. A young Mexican boy sits at a vintage wooden desk looking up at a kind blonde teacher. Warm painterly realism, Norman Rockwell style, nostalgic and hopeful lighting.";
        
        const loader = document.getElementById('loader');
        loader.style.display = 'flex';

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    instances: [{ prompt: prompt }],
                    parameters: { sampleCount: 1 }
                })
            });

            const result = await response.json();
            if (result.predictions && result.predictions[0].bytesBase64Encoded) {
                const imgUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                document.getElementById('title-image-box').innerHTML = `<img src="${imgUrl}" alt="Barrio Boy Title">`;
            }
        } catch (err) {
            console.error("Image generation failed", err);
            document.getElementById('title-image-box').innerHTML = `<div style="padding:20px; color:#666; text-align:center; font-size: 0.8rem;">VISUAL UPLINK FAILED. COMMENCING TEXTUAL JOURNEY.</div>`;
        } finally {
            loader.style.display = 'none';
        }
    }

    function startApp() {
        const nameInput = document.getElementById('user-name');
        if (!nameInput.value.trim()) {
            document.getElementById('error-msg').innerText = "IDENTIFICATION REQUIRED.";
            return;
        }
        userName = nameInput.value.trim();
        
        document.getElementById('screen-login').classList.remove('active');
        document.getElementById('screen-quiz').classList.add('active');
        renderQuestion();
    }

    function renderQuestion() {
        const q = questions[currentStep];
        document.getElementById('q-count').innerText = `Assessment ${String(currentStep + 1).padStart(2, '0')}`;
        document.getElementById('question-text').innerText = q.q;
        document.getElementById('progress-bar').style.width = `${((currentStep) / questions.length) * 100}%`;
        
        const container = document.getElementById('options-container');
        container.innerHTML = "";
        
        q.a.forEach((opt, i) => {
            const div = document.createElement('div');
            div.className = `option-card ${userAnswers[currentStep] === i ? 'selected' : ''}`;
            div.innerHTML = `
                <div class="option-label">${String.fromCharCode(65 + i)}</div>
                <div class="option-text">${opt}</div>
            `;
            div.onclick = () => selectOption(i);
            container.appendChild(div);
        });

        document.getElementById('prev-btn').disabled = currentStep === 0;
        document.getElementById('next-btn').innerText = (currentStep === questions.length - 1) ? "Finalize" : "Next";
    }

    function selectOption(idx) {
        userAnswers[currentStep] = idx;
        renderQuestion();
    }

    function nav(dir) {
        if (dir === 1 && userAnswers[currentStep] === null) return;
        
        currentStep += dir;
        if (currentStep >= questions.length) {
            showResults();
        } else {
            renderQuestion();
        }
    }

    function showResults() {
        let score = 0;
        userAnswers.forEach((ans, i) => {
            if (ans === questions[i].correct) score++;
        });

        document.getElementById('screen-quiz').classList.remove('active');
        document.getElementById('screen-results').classList.add('active');
        
        document.getElementById('res-name').innerText = userName;
        document.getElementById('res-score').innerText = score;

        const rank = document.getElementById('res-rank');
        const feedback = document.getElementById('res-feedback');

        if (score === 10) {
            rank.innerText = "MASTER LINGUIST";
            feedback.innerText = "Absolute mastery. You navigated the nuances of language and culture just like Ernesto. Miss Ryan would be incredibly proud.";
        } else if (score >= 7) {
            rank.innerText = "HONOR GRADUATE";
            feedback.innerText = "Excellent comprehension. You have a deep understanding of the themes of identity and belonging.";
        } else if (score >= 5) {
            rank.innerText = "BARRIO RESIDENT";
            feedback.innerText = "Solid effort. You captured the essence, but some finer details of the text were lost in transition.";
        } else {
            rank.innerText = "NEW ARRIVAL";
            feedback.innerText = "A fresh start. Like Ernesto with 'butterfly', keep practicing. Success is built one word at a time.";
        }
    }

    window.onload = () => {
        generateTitleImage();
    };
</script>

</body>
</html>
